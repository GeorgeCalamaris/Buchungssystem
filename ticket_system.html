{\rtf1\ansi\ansicpg1252\cocoartf2761
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 <!DOCTYPE html>\
<html lang="de">\
<head>\
    <meta charset="UTF-8">\
    <meta name="viewport" content="width=device-width, initial-scale=1.0">\
    <title>Ticketsystem Buchungsanfrage - Mockup DiLaS V2 (Refactored)</title>\
    <script src="https://cdn.tailwindcss.com"></script>\
    <style>\
        body \{ font-family: 'Inter', sans-serif; \}\
        .step-container \{ display: none; \}\
        .step-container.active \{ display: block; \}\
        .progress-bar-fill \{ transition: width 0.3s ease-in-out; \}\
        .modal \{ transition: opacity 0.25s ease; z-index: 150; \}\
        .modal-active \{ opacity: 1; pointer-events: auto; \}\
        .modal-inactive \{ opacity: 0; pointer-events: none; \}\
        .error-message \{ color: red; font-size: 0.875rem; margin-top: 0.25rem; \}\
\
        .tooltip \{\
            position: relative;\
            display: inline-block;\
            border-bottom: 1px dotted black;\
            cursor: help;\
        \}\
        .tooltip .tooltiptext \{\
            visibility: hidden; width: 260px; background-color: #555; color: #fff; text-align: left;\
            border-radius: 6px; padding: 8px; position: absolute; z-index: 10; bottom: 135%;\
            left: 50%; margin-left: -130px; opacity: 0; transition: opacity 0.3s;\
            font-size: 0.75rem; line-height: 1.1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2);\
        \}\
        .tooltip:hover .tooltiptext \{ visibility: visible; opacity: 1; \}\
\
        .calendar-grid \{ display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; \}\
        .calendar-day-label \{ font-weight: 600; text-align: center; margin-bottom: 0.25rem; font-size: 0.875rem; color: #4A5568; \}\
        .calendar-block \{\
            border: 1px solid #E2E8F0; padding: 0.75rem; border-radius: 0.375rem;\
            background-color: #F7FAFC; cursor: not-allowed; opacity: 0.7;\
            font-size: 0.8rem; line-height: 1.1rem; min-height: 70px;\
            display: flex; flex-direction: column; justify-content: space-between;\
        \}\
        .calendar-block.available \{\
            background-color: #EBF8FF; border-color: #90CDF4; cursor: pointer; opacity: 1;\
        \}\
        .calendar-block.available:hover \{ background-color: #BEE3F8; \}\
        .calendar-block.selected \{ background-color: #63B3ED; border-color: #4299E1; color: white; \}\
        .calendar-block-time \{ font-size: 0.7rem; color: #718096; \}\
        .calendar-block.selected .calendar-block-time \{ color: #EBF8FF; \}\
        .calendar-block-status \{ font-weight: 500; margin-top: 0.25rem; \}\
        .calendar-block.disabled \{ background-color: #CBD5E0; color: #718096; border-color: #A0AEC0; cursor: not-allowed; text-align: center; justify-content:center;\}\
        .required-label::after \{ content: ' *'; color: red; \}\
    </style>\
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">\
</head>\
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">\
\
    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-3xl">\
        <div class="flex justify-center mb-6">\
            <img src="https://placehold.co/180x80/003366/FFFFFF?text=Logo+DiL%40S" alt="Logo Digitale Landesschule M-V" class="h-16 sm:h-20">\
        </div>\
        <h1 id="mainTitle" class="text-2xl sm:text-3xl font-bold text-center text-blue-600 mb-2">Unterrichtsanfrage stellen</h1>\
        <p id="bookingPeriodInfo" class="text-center text-sm text-gray-500 mb-1" style="display:none;">Anfragezeitraum: 27. Oktober 2025 - 05. Dezember 2025</p>\
        <p id="bookingDeadlineInfo" class="text-center text-sm text-red-600 font-semibold mb-6" style="display:none;">Anfragefrist: 10. Oktober 2025</p>\
\
        <div id="progressBarContainer" class="mb-8" style="display:none;">\
            <div class="bg-gray-200 rounded-full h-2.5">\
                <div id="progressBar" class="bg-blue-500 h-2.5 rounded-full progress-bar-fill" style="width: 0%;"></div>\
            </div>\
            <p id="progressText" class="text-center text-sm text-gray-600 mt-2">Schritt 1 von 7</p>\
        </div>\
\
        <div id="welcomeScreen" class="step-container active">\
            <h2 class="text-xl sm:text-2xl font-semibold mb-4 text-center text-gray-700">Digitale Landesschule Mecklenburg-Vorpommern</h2>\
            <p class="text-center text-md text-blue-600 font-medium mb-1">Aktueller Anfragezeitraum: 27. Oktober 2025 - 05. Dezember 2025</p>\
            <p class="text-center text-sm text-red-600 font-semibold mb-4">Anfragefrist: 10. Oktober 2025</p>\
            <div class="text-sm text-gray-600 space-y-3 mb-6">\
                <p>Sehr geehrte Schulleitungen, \'fcber dieses System k\'f6nnen Sie flexibel Lehrkr\'e4fte f\'fcr den Vertretungsunterricht Ihrer Sch\'fclerinnen und Sch\'fcler in 6-Wochen-Bl\'f6cken anfragen.</p>\
                <h3 class="font-semibold text-gray-700 mt-3">Aktuell verf\'fcgbare F\'e4cher:</h3>\
                <ul id="welcomeFaecherListe" class="list-disc list-inside pl-4 text-sm text-gray-600 columns-2 sm:columns-3">\
                    \{/* Wird durch JS bef\'fcllt */\}\
                </ul>\
                <h3 class="font-semibold text-gray-700 mt-3">Unsere Unterrichtsformen (je nach Vorgabe der Stundentafelverordnung):</h3>\
                <p>Bitte beachten Sie, dass die gew\'e4hlte Unterrichtsform und die damit verbundene Dauer sich nach den Vorgaben der Stundentafelverordnung f\'fcr das gew\'e4hlte Fach und die Jahrgangsstufe richten.</p>\
                <ul class="list-disc list-inside pl-4 space-y-2">\
                    <li><strong><span class="tooltip">Synchronunterricht (SYU)<span class="tooltiptext">Dies ist ein direkter Live-Online-Unterricht mit der Lehrkraft und den Sch\'fclerinnen und Sch\'fclern per Videokonferenz (ViKo), typischerweise f\'fcr eine Doppelstunde (90 Minuten).</span></span>:</strong> Hier findet der Unterricht live online mit der Lehrkraft statt. Wenn laut Stundentafelverordnung mehr als zwei Unterrichtseinheiten (UE) f\'fcr den Kurs vorgesehen sind (z.B. bei 3 oder 4 Stunden laut Stundentafel), beinhaltet dies zus\'e4tzlich Anteile f\'fcr <span class="tooltip">Asynchronunterricht (ASYU)<span class="tooltiptext">Hier erhalten die Sch\'fclerinnen und Sch\'fcler Aufgaben und Materialien \'fcber die Lernplattform (z.B. itslearning), die sie selbstst\'e4ndig bearbeiten. Es gibt hierf\'fcr keinen festen Live-Termin mit der Lehrkraft.</span></span>. <strong class="text-blue-700">Wichtig f\'fcr Ihre Planung:</strong> Auch wenn nur der Synchronunterricht einen festen Termin im Kalenderblock hat, k\'f6nnen Sie als Schule die vollen Stunden laut Stundentafelverordnung als Vertretung abrechnen.</li>\
                    <li><strong><span class="tooltip">Flipped Classroom Unterricht (FCU)<span class="tooltiptext">Bei diesem Modell erhalten die Sch\'fclerinnen und Sch\'fcler Lerninhalte oft vorab zum selbstst\'e4ndigen Erarbeiten (asynchron). Die gemeinsame Online-Zeit mit der Lehrkraft dient dann der Vertiefung, Kl\'e4rung von Fragen und Anwendung des Gelernten.</span></span>:</strong> Diese Kurse umfassen laut Stundentafelverordnung in der Regel eine Unterrichtseinheit (UE), was einer 45-min\'fctigen Online-Einheit entspricht. Wenn Sie einen FCU-Kurs f\'fcr einen 6-Wochen-Block anfragen, bedeutet dies:\
                        <ul class="list-circle list-inside pl-4 mt-1">\
                            <li>Eine <strong>45-min\'fctige Videokonferenz (<span class="tooltip">ViKo<span class="tooltiptext">Videokonferenz: Live-Online-Sitzung mit der Lehrkraft und den Sch\'fclerinnen und Sch\'fclern.</span></span>)</strong> findet im von Ihnen gew\'e4hlten Zeitblock in der **ersten Unterrichtswoche** statt.</li>\
                            <li>Eine weitere <strong>45-min\'fctige Abschluss-Videokonferenz</strong> findet im **selben Zeitblock in der sechsten Unterrichtswoche** statt (f\'fcr den aktuellen Anfragezeitraum w\'e4re dies in der Woche vom 01.12. - 05.12.2025).</li>\
                            <li>Die Unterrichtszeit in den Wochen 2 bis 5 wird von der Lehrkraft als zeitlich unabh\'e4ngiger <span class="tooltip">Asynchronunterricht (ASYU)<span class="tooltiptext">Hier erhalten die Sch\'fclerinnen und Sch\'fcler Aufgaben und Materialien \'fcber die Lernplattform (z.B. itslearning), die sie selbstst\'e4ndig bearbeiten. Es gibt hierf\'fcr keinen festen Live-Termin mit der Lehrkraft.</span></span> gestaltet.</li>\
                        </ul>\
                        Der von Ihnen gew\'e4hlte Zeitblock ist somit f\'fcr die beiden Videokonferenz-Termine im gesamten 6-Wochen-Zeitraum f\'fcr diesen FCU-Kurs reserviert.</li>\
                </ul>\
                 <h3 class="font-semibold text-gray-700 mt-3">Vorbereitung der Sch\'fclerinnen und Sch\'fcler \'96 Unser Tutorialkurs:</h3>\
                <p>F\'fcr einen reibungslosen und effektiven Start in den digitalen Unterricht ist es f\'fcr unsere Lehrkr\'e4fte sehr wertvoll, wenn Ihre Sch\'fclerinnen und Sch\'fcler mit den technischen Grundlagen und unserer Arbeitsweise vertraut sind. Wir empfehlen Ihnen daher dringend, Ihre Sch\'fclerinnen und Sch\'fcler am **Tutorialkurs DiLaS auf itsLearning** teilnehmen zu lassen. Dieser dauert ca. 90 Minuten, kann von den Sch\'fclerinnen und Sch\'fclern selbstst\'e4ndig durchgef\'fchrt werden und macht sie mit unserer Lernplattform itsLearning sowie dem Videokonferenztool BigBlueButton vertraut. Gut vorbereitete Sch\'fclerinnen und Sch\'fcler erm\'f6glichen mehr effektive Unterrichtszeit f\'fcr alle Beteiligten.</p>\
                <p class="mt-3">Nach erfolgreicher Anfrage und Best\'e4tigung finden Sie alle wichtigen Dokumente und Informationen im Downloadbereich. Weitere Informationen und den Tutorialkurs finden Sie auch in unserer <a href="[PLATZHALTER_LINK_SERVICESTATION]" target="_blank" class="text-blue-500 hover:underline">Servicestation (Besprechungsraum) auf itsLearning</a> und im <a href="[PLATZHALTER_LINK_TUTORIALORDNER]" target="_blank" class="text-blue-500 hover:underline">Tutorialkurs auf itsLearning</a>.</p>\
            </div>\
            <button onclick="startBookingProcess()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2.5 px-4 rounded-md shadow-md transition duration-150 ease-in-out text-base">Unterrichtsanfrage starten</button>\
        </div>\
\
        <div id="stepContent1" class="step-container">\
             <h2 class="text-xl font-semibold mb-4 text-gray-700">Schritt 1: Fach ausw\'e4hlen</h2>\
            <label for="fach" class="block text-sm font-medium text-gray-700 mb-1">Ben\'f6tigtes Unterrichtsfach:</label>\
            <select id="fach" name="fach" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">\
                <option value="">Bitte w\'e4hlen...</option>\
                \{/* Optionen werden durch JS bef\'fcllt */\}\
            </select>\
            <div class="mt-6 flex justify-between">\
                <button onclick="prevStep()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Zur\'fcck zum Willkommen</button>\
                <button onclick="nextStep()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Weiter</button>\
            </div>\
        </div>\
\
        <div id="stepContent2" class="step-container">\
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Schritt 2: Schulform ausw\'e4hlen</h2>\
            <label for="schulform" class="block text-sm font-medium text-gray-700 mb-1">Schulform:</label>\
            <select id="schulform" name="schulform" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">\
                <option value="">Bitte w\'e4hlen...</option>\
                <option value="RegS">Regionale Schule (RegS)</option>\
                <option value="Gym">Gymnasium (Gym)</option>\
                <option value="MusikGym">Musikgymnasium</option>\
                <option value="SportGym">Sportgymnasium</option>\
                <option value="IGS">Integrierte Gesamtschule (IGS)</option>\
            </select>\
            <div class="mt-6 flex justify-between">\
                <button onclick="prevStep()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Zur\'fcck</button>\
                <button onclick="nextStep()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Weiter</button>\
            </div>\
        </div>\
\
        <div id="stepContent3" class="step-container">\
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Schritt 3: Jahrgangsstufe ausw\'e4hlen</h2>\
            <label for="jahrgang" class="block text-sm font-medium text-gray-700 mb-1">Jahrgangsstufe:</label>\
            <select id="jahrgang" name="jahrgang" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">\
                <option value="">Bitte w\'e4hlen...</option>\
                \{/* Optionen werden durch JS dynamisch bef\'fcllt */\}\
            </select>\
            <p id="kursInfo" class="mt-3 text-sm text-blue-600"></p>\
            <div class="mt-6 flex justify-between">\
                <button onclick="prevStep()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Zur\'fcck</button>\
                <button onclick="nextStep()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Weiter</button>\
            </div>\
        </div>\
\
        <div id="stepContent4" class="step-container">\
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Schritt 4: Voraussetzungen an der Schule</h2>\
            <p class="text-sm text-gray-600 mb-4">Damit der digitale Vertretungsunterricht durch die DiLaS erfolgreich durchgef\'fchrt werden kann, m\'fcssen an Ihrer Schule folgende Voraussetzungen sichergestellt sein:</p>\
            <ul class="list-disc list-inside pl-4 space-y-2 text-sm mb-6 bg-gray-50 p-4 rounded-md border">\
                <li>Eine <strong>Aufsichtsperson</strong> ist w\'e4hrend des gesamten digitalen Unterrichts vor Ort anwesend und stellt die aktive Teilnahme sowie die Einhaltung von Verhaltensregeln sicher.</li>\
                <li>Die Sch\'fclerinnen und Sch\'fcler wurden vorab \'fcber das **Pers\'f6nlichkeitsrecht und Urheberrecht** belehrt (entsprechende Materialien finden Sie nach der Buchung im Downloadbereich).</li>\
                <li>Eine **stabile Internetverbindung** (idealerweise LAN-Anbindung f\'fcr den Unterrichtsraum) ist gew\'e4hrleistet.</li>\
                <li>Die notwendige **technische Ausstattung** f\'fcr die Sch\'fclerinnen und Sch\'fcler und den Raum ist funktionsf\'e4hig vorhanden (Details werden im n\'e4chsten Schritt abgefragt).</li>\
                <li>Alle teilnehmenden Sch\'fclerinnen und Sch\'fcler verf\'fcgen \'fcber ihre **aktuellen und funktionierenden itsLearning-Zugangsdaten**.</li>\
                <li>Die **Anwesenheit** der Sch\'fclerinnen und Sch\'fcler wird wie gewohnt im Klassenbuch Ihrer Schule dokumentiert.</li>\
            </ul>\
             <label class="flex items-center mt-4 p-3 border border-gray-300 rounded-md hover:bg-gray-50 transition cursor-pointer">\
                <input type="checkbox" id="anforderungen_bestaetigt" name="anforderungen_bestaetigt" value="ja" class="form-checkbox rounded text-blue-500 h-5 w-5">\
                <span class="ml-3 text-sm font-medium text-gray-700 required-label">Ich habe die Anforderungen an unsere Schule gelesen und best\'e4tige, dass diese f\'fcr den angefragten Zeitraum erf\'fcllt werden k\'f6nnen.</span>\
             </label>\
             <p id="anforderungenError" class="error-message" style="display: none;">Bitte best\'e4tigen Sie die Anforderungen, um fortzufahren.</p>\
\
            <div class="mt-6 flex justify-between">\
                <button onclick="prevStep()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Zur\'fcck</button>\
                <button onclick="nextStep()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Weiter</button>\
            </div>\
        </div>\
\
        <div id="stepContent5" class="step-container">\
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Schritt 5: Verf\'fcgbares Zeitfenster ausw\'e4hlen</h2>\
            <p class="text-sm text-gray-600 mb-3">Basierend auf Ihrer Auswahl (Fach: <span id="s5_fach" class="font-medium"></span>, Schulform: <span id="s5_schulform" class="font-medium"></span>, Jahrgang: <span id="s5_jahrgang" class="font-medium"></span>) ist folgender Kurstyp erforderlich: <strong id="s5_kurstyp_kalender" class="text-blue-600"></strong>.</p>\
            <p class="text-sm text-gray-600 mb-4">Bitte w\'e4hlen Sie einen verf\'fcgbaren Block f\'fcr den 6-Wochen-Zeitraum. Die genaue Startzeit innerhalb des Blocks legen Sie im n\'e4chsten Schritt fest.</p>\
\
            <div class="calendar-grid mb-4">\
                <div><div class="calendar-day-label">Montag</div><div id="Mo_B1_cell" class="calendar-block"></div><div id="Mo_B2_cell" class="calendar-block"></div><div id="Mo_B3_cell" class="calendar-block"></div></div>\
                <div><div class="calendar-day-label">Dienstag</div><div id="Di_B1_cell" class="calendar-block"></div><div id="Di_B2_cell" class="calendar-block"></div><div id="Di_B3_cell" class="calendar-block"></div></div>\
                <div><div class="calendar-day-label">Mittwoch</div><div id="Mi_B1_cell" class="calendar-block"></div><div id="Mi_B2_cell" class="calendar-block"></div><div id="Mi_B3_cell" class="calendar-block"></div></div>\
                <div><div class="calendar-day-label">Donnerstag</div><div id="Do_B1_cell" class="calendar-block"></div><div id="Do_B2_cell" class="calendar-block"></div><div id="Do_B3_cell" class="calendar-block disabled">Belegt</div></div>\
                <div><div class="calendar-day-label">Freitag</div><div id="Fr_B1_cell" class="calendar-block"></div><div id="Fr_B2_cell" class="calendar-block"></div><div id="Fr_B3_cell" class="calendar-block"></div></div>\
            </div>\
            <input type="hidden" id="selectedBlockValue" name="selectedBlockValue">\
            <p id="calendarError" class="error-message" style="display: none;">F\'fcr den gew\'e4hlten Kurstyp sind derzeit keine passenden Zeitfenster verf\'fcgbar.</p>\
\
            <div class="mt-6 flex justify-between">\
                <button onclick="prevStep()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Zur\'fcck</button>\
                <button onclick="nextStep()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Weiter</button>\
            </div>\
        </div>\
\
        <div id="stepContent6" class="step-container">\
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Schritt 6: Zus\'e4tzliche Informationen</h2>\
            <div class="space-y-6">\
                 <div>\
                    <label for="startzeit" class="block text-sm font-medium text-gray-700 mb-1 required-label">Gew\'fcnschte Startzeit innerhalb des Blocks:</label>\
                    <input type="time" id="startzeit" name="startzeit" required class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">\
                    <p id="startzeitError" class="error-message" style="display: none;">Die Kursdauer \'fcberschreitet das Blockende oder kollidiert mit einer anderen Buchung. Bitte w\'e4hlen Sie eine andere Startzeit.</p>\
                    <p class="mt-1 text-xs text-gray-500">Gew\'e4hlter Block: <span id="s6_block_info" class="font-medium"></span>. Kurstyp: <span id="s6_kurstyp_info" class="font-medium"></span> (Dauer der Online-Einheit ca. <span id="s6_kursdauer_info" class="font-medium"></span> Min.).</p>\
                </div>\
\
                <div>\
                    <label for="schuelerAnzahl" class="block text-sm font-medium text-gray-700 mb-1 required-label">Anzahl der Sch\'fclerinnen und Sch\'fcler in der Lerngruppe:</label>\
                    <input type="number" id="schuelerAnzahl" name="schuelerAnzahl" min="1" required class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">\
                    <p id="schuelerAnzahlError" class="error-message" style="display: none;">Bitte geben Sie eine g\'fcltige Anzahl an Sch\'fclerinnen und Sch\'fclern an (mind. 1).</p>\
                </div>\
                <fieldset>\
                    <legend class="text-sm font-medium text-gray-700 mb-1">Technische Ausstattung der Sch\'fclerinnen und Sch\'fcler:</legend>\
                    <div class="mt-2 space-y-2">\
                        <label class="block text-sm text-gray-700 mb-1 required-label">Endger\'e4t pro Sch\'fcler/in:</label>\
                         <div class="radio-group ml-4">\
                            <label><input type="radio" name="ausstattung_geraet_typ" value="Laptop/PC" class="form-radio text-blue-500 h-4 w-4"> Laptop/PC</label>\
                            <label><input type="radio" name="ausstattung_geraet_typ" value="Tablet_mit_Tastatur" class="form-radio text-blue-500 h-4 w-4"> Tablet mit Tastatur</label>\
                            <label><input type="radio" name="ausstattung_geraet_typ" value="Tablet_ohne_Tastatur" class="form-radio text-blue-500 h-4 w-4"> Tablet ohne Tastatur</label>\
                            <label><input type="radio" name="ausstattung_geraet_typ" value="Standrechner" class="form-radio text-blue-500 h-4 w-4"> Standrechner (im Raum)</label>\
                            <label><input type="radio" name="ausstattung_geraet_typ" value="Keins" class="form-radio text-blue-500 h-4 w-4"> Kein pers\'f6nliches Endger\'e4t</label>\
                         </div>\
\
                        <div class="pt-2">\
                            <p class="text-xs text-gray-600 mb-1 required-label">Kopfh\'f6rer:</p>\
                            <label class="flex items-center ml-4"><input type="checkbox" name="ausstattung_kopfhoerer_schule" value="ja" class="form-checkbox rounded text-blue-500 h-4 w-4"> <span class="ml-2 text-sm text-gray-700">Von der Schule gestellt</span></label>\
                            <label class="flex items-center ml-4"><input type="checkbox" name="ausstattung_kopfhoerer_sus" value="ja" class="form-checkbox rounded text-blue-500 h-4 w-4"> <span class="ml-2 text-sm text-gray-700">Von Sch\'fcler/innen selbst mitgebracht</span></label>\
                        </div>\
                        <div class="pt-2">\
                            <p class="text-xs text-gray-600 mb-1 required-label">Mikrofone (f\'fcr aktive Teilnahme):</p>\
                            <label class="flex items-center ml-4"><input type="checkbox" name="ausstattung_mikrofon_schule" value="ja" class="form-checkbox rounded text-blue-500 h-4 w-4"> <span class="ml-2 text-sm text-gray-700">Von der Schule gestellt (z.B. Headsets)</span></label>\
                            <label class="flex items-center ml-4"><input type="checkbox" name="ausstattung_mikrofon_sus" value="ja" class="form-checkbox rounded text-blue-500 h-4 w-4"> <span class="ml-2 text-sm text-gray-700">Von Sch\'fcler/innen selbst mitgebracht (z.B. Headsets)</span></label>\
                        </div>\
                         <label class="flex items-center pt-2"><input type="checkbox" name="ausstattung_kamera_sus" value="ja" class="form-checkbox rounded text-blue-500 h-4 w-4"> <span class="ml-2 text-sm text-gray-700">Kameras an den Endger\'e4ten der Sch\'fcler/innen vorhanden/nutzbar</span></label>\
                    </div>\
                </fieldset>\
\
                <fieldset>\
                    <legend class="text-sm font-medium text-gray-700 mb-1">Technische Ausstattung im Raum (falls keine 1:1 Ausstattung der SuS):</legend>\
                     <div class="mt-2 space-y-2">\
                        <label class="flex items-center"><input type="checkbox" name="ausstattung_raum_digitafel" value="ja" class="form-checkbox rounded text-blue-500 h-4 w-4"> <span class="ml-2 text-sm text-gray-700">Digitale Tafel / Smartboard</span></label>\
                        <label class="flex items-center"><input type="checkbox" name="ausstattung_raum_mikrofon_zentral" value="ja" class="form-checkbox rounded text-blue-500 h-4 w-4"> <span class="ml-2 text-sm text-gray-700">Zentrales Mikrofon f\'fcr den Raum</span></label>\
                     </div>\
                </fieldset>\
                 <fieldset>\
                    <legend class="text-sm font-medium text-gray-700 mb-1 required-label">Internetverbindung im Raum:</legend>\
                    <div class="mt-2 space-y-2 radio-group">\
                        <label><input type="radio" name="internet_raum" value="WLAN" class="form-radio text-blue-500 h-4 w-4"> WLAN</label>\
                        <label><input type="radio" name="internet_raum" value="Netzwerkkabel" class="form-radio text-blue-500 h-4 w-4"> Netzwerkkabel (LAN)</label>\
                    </div>\
                </fieldset>\
\
                <div>\
                    <p class="text-sm font-medium text-gray-700 mb-1">Vorbereitung der Sch\'fclerinnen und Sch\'fcler:</p>\
                    <p class="text-xs text-gray-600 mb-2">Die Teilnahme am DiLaS Tutorialkurs (ItsLearning & BBB Grundlagen) ist f\'fcr einen reibungslosen Unterrichtsstart sehr hilfreich f\'fcr unsere Lehrkr\'e4fte und Ihre Sch\'fclerinnen und Sch\'fcler (mehr effektive Unterrichtszeit).</p>\
                    <label class="flex items-center"><input type="checkbox" id="tutorial_kenntnis" name="tutorial_kenntnis" value="ja" class="form-checkbox rounded text-blue-500 h-4 w-4"> <span class="ml-2 text-sm text-gray-700">Wir nehmen die Empfehlung zum Tutorialkurs zur Kenntnis und werden die Sch\'fclerinnen und Sch\'fcler entsprechend informieren.</span></label>\
                </div>\
\
                <div>\
                    <label class="block text-sm font-medium text-gray-700 mb-1">M\'f6chten Sie im Vorfeld Kontakt zur unterrichtenden DiLaS-Lehrkraft aufnehmen?</label>\
                    <div class="flex space-x-4 radio-group">\
                        <label><input type="radio" name="kontakt_vorfeld" value="Ja" class="form-radio text-blue-500 h-4 w-4"> Ja</label>\
                        <label><input type="radio" name="kontakt_vorfeld" value="Nein" class="form-radio text-blue-500 h-4 w-4"> Nein</label>\
                    </div>\
                     <p class="text-xs text-gray-500 ml-1 mt-1">Die Kontaktdaten der zugewiesenen Lehrkraft erhalten Sie mit der Best\'e4tigungs-E-Mail.</p>\
                </div>\
                <div>\
                    <label for="ansprechpartner_name_schule" class="block text-sm font-medium text-gray-700 mb-1 required-label">Name Ansprechpartner/in an Ihrer Schule (f\'fcr DiLaS-Lehrkraft):</label>\
                    <input type="text" id="ansprechpartner_name_schule" name="ansprechpartner_name_schule" required class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">\
                </div>\
\
                <div>\
                    <label for="ansprechpartner_email_schule" class="block text-sm font-medium text-gray-700 mb-1 required-label">E-Mail-Adresse f\'fcr die Buchungsbest\'e4tigung:</label>\
                    <input type="email" id="ansprechpartner_email_schule" name="ansprechpartner_email_schule" required class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">\
                </div>\
\
                <div>\
                    <label class="block text-sm font-medium text-gray-700 mb-1">Ben\'f6tigen Sie oder die Sch\'fclerinnen und Sch\'fcler eine technische Einweisung durch DiLaS?</label>\
                    <div class="flex space-x-4 radio-group">\
                        <label><input type="radio" name="einweisung" value="Ja" class="form-radio text-blue-500 h-4 w-4"> Ja</label>\
                        <label><input type="radio" name="einweisung" value="Nein" class="form-radio text-blue-500 h-4 w-4"> Nein</label>\
                    </div>\
                </div>\
                 <div>\
                    <label for="sonstiges_technik" class="block text-sm font-medium text-gray-700 mb-1">Sonstige Besonderheiten oder Anmerkungen:</label>\
                    <textarea id="sonstiges_technik" name="sonstiges_technik" rows="2" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"></textarea>\
                </div>\
            </div>\
            <div class="mt-6 flex justify-between">\
                <button onclick="prevStep()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Zur\'fcck</button>\
                <button onclick="nextStep()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Weiter zur \'dcbersicht</button>\
            </div>\
        </div>\
\
        <div id="stepContent7" class="step-container">\
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Schritt 7: Zusammenfassung Ihrer Anfrage</h2>\
            <div id="summaryContainer" class="bg-gray-50 p-4 rounded-md space-y-2 text-sm">\
                </div>\
            <p class="mt-4 text-xs text-gray-500">Bitte \'fcberpr\'fcfen Sie Ihre Angaben. Mit Klick auf "Buchungsanfrage senden" \'fcbermitteln Sie Ihre Anfrage an die DiLaS. Sie erhalten eine Best\'e4tigungs-E-Mail an die angegebene Adresse (<span id="summary_kontakt_email_display" class="font-semibold"></span>), sobald Ihre Anfrage gepr\'fcft und die Lehrkraft final zugewiesen wurde. In dieser E-Mail finden Sie auch die Kontaktdaten der Lehrkraft, die Sie dann \'fcber die DiLaS Servicestation auf itsLearning kontaktieren k\'f6nnen.</p>\
            <div class="mt-6 flex justify-between">\
                <button onclick="prevStep()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Zur\'fcck</button>\
                <button onclick="confirmBooking()" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Buchungsanfrage senden</button>\
            </div>\
        </div>\
\
        <div id="stepContent8" class="step-container text-center">\
            <svg class="w-16 h-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>\
            <h2 class="text-2xl font-semibold mb-3 text-gray-700">Buchungsanfrage erfolgreich \'fcbermittelt!</h2>\
            <p class="text-gray-600 mb-2">Vielen Dank! Ihre Anfrage wurde an uns gesendet und wird nun gepr\'fcft.</p>\
            <p class="text-gray-600 mb-4">Sie erhalten in K\'fcrze eine E-Mail an <strong id="confirmEmail"></strong>, sobald Ihre Anfrage bearbeitet und eine Lehrkraft zugewiesen wurde. Diese E-Mail enth\'e4lt dann auch die Kontaktdaten der Lehrkraft f\'fcr eventuelle Absprachen (erreichbar \'fcber die DiLaS Servicestation auf itsLearning) sowie Informationen zur gebuchten Sch\'fcleranzahl.</p>\
            <button onclick="openDownloadModal()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Downloadpaket \'f6ffnen (ZIP)</button>\
             <button onclick="resetBookingProcess()" class="mt-4 w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Neue Buchungsanfrage</button>\
        </div>\
    </div>\
\
    <div id="downloadModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center modal modal-inactive p-4">\
        <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-md transform transition-all">\
            <div class="flex justify-between items-center mb-4">\
                <h3 class="text-xl font-semibold text-gray-700">Downloadbereich</h3>\
                <button onclick="closeDownloadModal()" class="text-gray-400 hover:text-gray-600">\
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>\
                </button>\
            </div>\
            <p class="text-sm text-gray-600 mb-4">Hier finden Sie wichtige Dokumente und Informationen als ZIP-Archiv zum Herunterladen:</p>\
            <ul class="space-y-2 text-sm">\
                <li><a href="#" class="text-blue-500 hover:underline">DiLaS_Informationspaket_Schulen.zip</a> (enth\'e4lt u.a.:)</li>\
                <li class="ml-4">- Leitfaden_Nutzung_DiLaS_NB.pdf</li>\
                <li class="ml-4">- Anschreiben_an_die_betreuende_Fachkraft_vor_Ort.pdf</li>\
                <li class="ml-4">- Hinweise_zur_Fortbildung_der_Schuelerinnen_und_Schueler.pdf</li>\
                <li class="ml-4">- Datenschutzbelehrung_DiLaS.pdf</li>\
                <li class="ml-4">- Urheberrechtsbelehrung_DiLaS.pdf</li>\
                <li class="ml-4">- Technische_Ausstattung_Schulklassen_digitaler_Unterricht.pdf</li>\
                <li class="ml-4">- Bestellung_zum_Technikcheck.docx</li>\
            </ul>\
            <button onclick="closeDownloadModal()" class="mt-6 w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">Schlie\'dfen</button>\
        </div>\
    </div>\
\
    <script>\
        // --- CONFIGURATION & CONSTANTS ---\
        const CONFIG = \{\
            totalSteps: 7,\
            blockStartDate: new Date(2025, 9, 27), // October 27, 2025\
            faecherListe: [\
                "Mathematik", "Deutsch", "Englisch", "Physik", "Chemie",\
                "Biologie", "Geschichte", "Sozialkunde", "Philosophie", "Franz\'f6sisch"\
            ],\
            initialBlockStates: [\
                \{ id: "Mo_B1", status: "frei", booked_fcu_times: [] \},\
                \{ id: "Mo_B2", status: "1_fcu_gebucht", booked_fcu_times: [\{start: timeToMinutes("10:30"), end: timeToMinutes("11:15")\}] \},\
                \{ id: "Mo_B3", status: "syu_gebucht", booked_fcu_times: [] \},\
                \{ id: "Di_B1", status: "frei", booked_fcu_times: [] \},\
                \{ id: "Di_B2", status: "2_fcu_gebucht", booked_fcu_times: [\{start: timeToMinutes("10:00"), end: timeToMinutes("10:45")\}, \{start: timeToMinutes("11:30"), end: timeToMinutes("12:15")\}] \},\
                \{ id: "Di_B3", status: "frei", booked_fcu_times: [] \},\
                \{ id: "Mi_B1", status: "frei", booked_fcu_times: [] \},\
                \{ id: "Mi_B2", status: "frei", booked_fcu_times: [] \},\
                \{ id: "Mi_B3", status: "1_fcu_gebucht", booked_fcu_times: [\{start: timeToMinutes("14:00"), end: timeToMinutes("14:45")\}] \},\
                \{ id: "Do_B1", status: "frei", booked_fcu_times: [] \},\
                \{ id: "Do_B2", status: "frei", booked_fcu_times: [] \},\
                \{ id: "Fr_B1", status: "syu_gebucht", booked_fcu_times: [] \},\
                \{ id: "Fr_B2", status: "frei", booked_fcu_times: [] \},\
                \{ id: "Fr_B3", status: "frei", booked_fcu_times: [] \},\
            ],\
            blockDefinitions: \{\
                "Mo_B1": \{ start: "07:30", end: "10:00", text: "Block 1 (07:30-10:00)"\}, "Mo_B2": \{ start: "10:00", end: "12:30", text: "Block 2 (10:00-12:30)"\}, "Mo_B3": \{ start: "12:30", end: "16:00", text: "Block 3 (12:30-16:00)"\},\
                "Di_B1": \{ start: "07:30", end: "10:00", text: "Block 1 (07:30-10:00)"\}, "Di_B2": \{ start: "10:00", end: "12:30", text: "Block 2 (10:00-12:30)"\}, "Di_B3": \{ start: "12:30", end: "16:00", text: "Block 3 (12:30-16:00)"\},\
                "Mi_B1": \{ start: "07:30", end: "10:00", text: "Block 1 (07:30-10:00)"\}, "Mi_B2": \{ start: "10:00", end: "12:30", text: "Block 2 (10:00-12:30)"\}, "Mi_B3": \{ start: "12:30", end: "16:00", text: "Block 3 (12:30-16:00)"\},\
                "Do_B1": \{ start: "07:30", end: "10:00", text: "Block 1 (07:30-10:00)"\}, "Do_B2": \{ start: "10:00", end: "12:30", text: "Block 2 (10:00-12:30)"\},\
                "Fr_B1": \{ start: "07:30", end: "10:00", text: "Block 1 (07:30-10:00)"\}, "Fr_B2": \{ start: "10:00", end: "12:30", text: "Block 2 (10:00-12:30)"\}, "Fr_B3": \{ start: "12:30", end: "16:00", text: "Block 3 (12:30-16:00)"\},\
            \},\
            tooltipExplanations: \{\
                "SYU": "Synchronunterricht: Direkter Online-Unterricht mit der Lehrkraft.",\
                "FCU": "Flipped Classroom Unterricht: Kurze Online-Einheiten, oft mit Selbstlernphasen.",\
                "ASYU": "Asynchronunterricht: Flexible Lernangebote zur selbstst\'e4ndigen Bearbeitung.",\
                "ViKo": "Videokonferenz: Live-Online-Sitzung mit Lehrkraft und Sch\'fclerinnen und Sch\'fclern."\
            \}\
        \};\
\
        // --- STATE ---\
        let currentStep = 0;\
        let bookingData = \{\}; // Stores all data from the booking form\
        let simulatedBlockStates = JSON.parse(JSON.stringify(CONFIG.initialBlockStates)); // Dynamic state for calendar\
\
        // --- DOM ELEMENTS (CACHE FREQUENTLY USED ELEMENTS) ---\
        const DOM = \{\
            mainTitle: document.getElementById('mainTitle'),\
            progressBarContainer: document.getElementById('progressBarContainer'),\
            progressBar: document.getElementById('progressBar'),\
            progressText: document.getElementById('progressText'),\
            bookingPeriodInfo: document.getElementById('bookingPeriodInfo'),\
            bookingDeadlineInfo: document.getElementById('bookingDeadlineInfo'),\
            welcomeScreen: document.getElementById('welcomeScreen'),\
            fachSelect: document.getElementById('fach'),\
            schulformSelect: document.getElementById('schulform'),\
            jahrgangSelect: document.getElementById('jahrgang'),\
            kursInfoEl: document.getElementById('kursInfo'),\
            anforderungenBestaetigtCheckbox: document.getElementById('anforderungen_bestaetigt'),\
            anforderungenError: document.getElementById('anforderungenError'),\
            s5Fach: document.getElementById('s5_fach'),\
            s5Schulform: document.getElementById('s5_schulform'),\
            s5Jahrgang: document.getElementById('s5_jahrgang'),\
            s5KurstypKalender: document.getElementById('s5_kurstyp_kalender'),\
            selectedBlockValueInput: document.getElementById('selectedBlockValue'),\
            calendarErrorEl: document.getElementById('calendarError'),\
            startzeitInput: document.getElementById('startzeit'),\
            startzeitError: document.getElementById('startzeitError'),\
            s6BlockInfo: document.getElementById('s6_block_info'),\
            s6KurstypInfo: document.getElementById('s6_kurstyp_info'),\
            s6KursdauerInfo: document.getElementById('s6_kursdauer_info'),\
            schuelerAnzahlInput: document.getElementById('schuelerAnzahl'),\
            schuelerAnzahlError: document.getElementById('schuelerAnzahlError'),\
            ansprechpartnerNameInput: document.getElementById('ansprechpartner_name_schule'),\
            ansprechpartnerEmailInput: document.getElementById('ansprechpartner_email_schule'),\
            tutorialKenntnisCheckbox: document.getElementById('tutorial_kenntnis'),\
            sonstigesTechnikTextarea: document.getElementById('sonstiges_technik'),\
            summaryContainer: document.getElementById('summaryContainer'),\
            summaryKontaktEmailDisplay: document.getElementById('summary_kontakt_email_display'),\
            confirmEmailDisplay: document.getElementById('confirmEmail'),\
            downloadModal: document.getElementById('downloadModal'),\
            welcomeFaecherListe: document.getElementById('welcomeFaecherListe')\
        \};\
\
        // --- UTILITY FUNCTIONS ---\
        function timeToMinutes(timeStr) \{\
            if (!timeStr || !timeStr.includes(':')) return 0;\
            const [hours, minutes] = timeStr.split(':').map(Number);\
            return hours * 60 + minutes;\
        \}\
\
        function formatDate(date) \{\
            const d = new Date(date);\
            const day = ("0" + d.getDate()).slice(-2);\
            const month = ("0" + (d.getMonth() + 1)).slice(-2);\
            const year = d.getFullYear();\
            return `$\{day\}.$\{month\}.$\{year\}`;\
        \}\
\
        function createTooltip(abbreviation, explanation) \{\
            return `<span class="tooltip">$\{abbreviation\}<span class="tooltiptext">$\{explanation\}</span></span>`;\
        \}\
\
        function addTooltipsToText(text) \{\
            if (!text) return "";\
            let newText = text;\
            Object.keys(CONFIG.tooltipExplanations).forEach(key => \{\
                const regex = new RegExp(`\\\\b$\{key\}\\\\b`, 'g');\
                newText = newText.replace(regex, createTooltip(key, CONFIG.tooltipExplanations[key]));\
            \});\
            return newText;\
        \}\
\
        // --- UI UPDATE FUNCTIONS ---\
        function updateProgressBar() \{\
            const progress = currentStep > 0 ? (currentStep - 1) / CONFIG.totalSteps * 100 : 0;\
            DOM.progressBar.style.width = progress + '%';\
            DOM.progressText.innerText = currentStep > 0 ? `Schritt $\{currentStep\} von $\{CONFIG.totalSteps\}` : '';\
        \}\
\
        function showStepUI(stepNumber) \{\
            document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));\
            if (stepNumber === 0) \{ // Welcome screen\
                DOM.welcomeScreen.classList.add('active');\
                DOM.progressBarContainer.style.display = 'none';\
                DOM.bookingPeriodInfo.style.display = 'none';\
                DOM.bookingDeadlineInfo.style.display = 'none';\
                DOM.mainTitle.innerText = 'Digitale Landesschule M-V';\
            \} else \{\
                const stepContentEl = document.getElementById('stepContent' + stepNumber);\
                if (stepContentEl) stepContentEl.classList.add('active');\
                DOM.progressBarContainer.style.display = 'block';\
                DOM.bookingPeriodInfo.style.display = 'block';\
                DOM.bookingDeadlineInfo.style.display = 'block';\
                DOM.mainTitle.innerText = 'Unterrichtsanfrage stellen';\
            \}\
            currentStep = stepNumber;\
            if (stepNumber > 0 && stepNumber <= CONFIG.totalSteps) \{\
                updateProgressBar();\
            \}\
        \}\
\
        function populateFaecherDropdown() \{\
            DOM.welcomeFaecherListe.innerHTML = '';\
            DOM.fachSelect.innerHTML = '<option value="">Bitte w\'e4hlen...</option>';\
            CONFIG.faecherListe.forEach(fach => \{\
                const option = document.createElement('option');\
                option.value = fach;\
                option.textContent = fach;\
                DOM.fachSelect.appendChild(option);\
\
                const listItem = document.createElement('li');\
                listItem.textContent = fach;\
                DOM.welcomeFaecherListe.appendChild(listItem);\
            \});\
        \}\
\
        function updateJahrgangsDropdown() \{\
            const fach = DOM.fachSelect.value;\
            const schulform = DOM.schulformSelect.value;\
            DOM.jahrgangSelect.innerHTML = '<option value="">Bitte w\'e4hlen...</option>';\
            DOM.kursInfoEl.innerHTML = '';\
            bookingData.kurstyp = null;\
\
            if (!fach || !schulform) return;\
\
            let verfuegbareJahrgaenge = [7, 8, 9, 10];\
            const istGymOberstufeSchulform = ["Gym", "MusikGym", "SportGym", "IGS"].includes(schulform);\
            const istHauptfachOderFranzoesisch = ["Mathematik", "Deutsch", "Englisch", "Franz\'f6sisch"].includes(fach);\
\
            if (istGymOberstufeSchulform && istHauptfachOderFranzoesisch) \{\
                verfuegbareJahrgaenge.push(11, 12);\
            \}\
\
            const finaleJahrgaenge = verfuegbareJahrgaenge.filter(jg => \{\
                const details = getKursDetailsLogic(fach, schulform, jg.toString());\
                return details.kstStunden > 0;\
            \});\
\
            if (finaleJahrgaenge.length === 0) \{\
                DOM.kursInfoEl.innerHTML = `<span class="text-red-500">F\'fcr das gew\'e4hlte Fach und die Schulform sind aktuell keine Jahrgangsstufen im DiLaS-Angebot vorgesehen.</span>`;\
            \} else \{\
                finaleJahrgaenge.forEach(jg => \{\
                    const option = document.createElement('option');\
                    option.value = jg;\
                    option.textContent = `Klasse $\{jg\}`;\
                    DOM.jahrgangSelect.appendChild(option);\
                \});\
            \}\
        \}\
\
        function updateKursInfoUI() \{\
            const fach = DOM.fachSelect.value;\
            const schulform = DOM.schulformSelect.value;\
            const jahrgang = DOM.jahrgangSelect.value;\
\
            if (fach && schulform && jahrgang) \{\
                const details = getKursDetailsLogic(fach, schulform, jahrgang);\
                bookingData.kursDetails = details; // Store details in bookingData\
\
                if (details.kstStunden === 0) \{\
                    DOM.kursInfoEl.innerHTML = `<span class="text-red-500">F\'fcr diese Auswahl ist derzeit kein DiLaS-Angebot vorgesehen.</span>`;\
                    return;\
                \}\
\
                let text = `Dieser Kurs basiert auf $\{details.kstStunden\} Stunde(n) laut Stundentafelverordnung.<br>Unterrichtsform: <strong>$\{addTooltipsToText(details.typ)\}</strong> (Online-Einheit: $\{details.dauerMin\} Min.).`;\
                if (details.isFCU) \{\
                    const abschlussWocheStart = new Date(CONFIG.blockStartDate);\
                    abschlussWocheStart.setDate(CONFIG.blockStartDate.getDate() + 5 * 7);\
                    const abschlussWocheEnde = new Date(abschlussWocheStart);\
                    abschlussWocheEnde.setDate(abschlussWocheStart.getDate() + 4);\
                    text += `<br>Bei einem Flipped Classroom Unterricht (FCU) findet die erste Videokonferenz (ViKo) im gebuchten Zeitblock in der ersten Woche statt. Die Abschluss-ViKo ist im selben Slot in der Woche vom $\{formatDate(abschlussWocheStart)\} bis $\{formatDate(abschlussWocheEnde)\}. Dazwischen erfolgt der Unterricht als Asynchronunterricht (ASYU).`;\
                    bookingData.abschlussVikoInfo = `Abschluss-Videokonferenz in Woche 6 (ca. $\{formatDate(abschlussWocheStart)\} - $\{formatDate(abschlussWocheEnde)\})`;\
                \} else \{\
                    bookingData.abschlussVikoInfo = "";\
                \}\
                if (details.asyuUE > 0) \{\
                    text += `<br>Davon sind $\{details.syuUE\} Unterrichtseinheiten $\{addTooltipsToText("SYU")\} (fester Termin) und $\{details.asyuUE\} Unterrichtseinheiten $\{addTooltipsToText("ASYU")\} (flexible Bearbeitung durch die Sch\'fclerinnen und Sch\'fcler). Sie k\'f6nnen als Schule die vollen $\{details.kstStunden\} KST-Stunden abrechnen.`;\
                \}\
                DOM.kursInfoEl.innerHTML = text;\
            \} else \{\
                DOM.kursInfoEl.innerHTML = '';\
            \}\
        \}\
\
        function populateCalendarUI() \{\
            DOM.calendarErrorEl.style.display = 'none';\
            const kursDetails = bookingData.kursDetails;\
\
            if (!kursDetails || kursDetails.kstStunden === 0) \{\
                DOM.s5KurstypKalender.innerHTML = addTooltipsToText(kursDetails ? kursDetails.typ : "Nicht verf\'fcgbar");\
                DOM.calendarErrorEl.innerText = "F\'fcr die vorherige Auswahl ist kein Kurs vorgesehen oder die Auswahl ist unvollst\'e4ndig.";\
                DOM.calendarErrorEl.style.display = 'block';\
                // Disable all calendar blocks\
                Object.keys(CONFIG.blockDefinitions).forEach(blockId => \{\
                    const cell = document.getElementById(blockId + "_cell");\
                    if (!cell) return;\
                    const blockDef = CONFIG.blockDefinitions[blockId];\
                    cell.innerHTML = `<div class="calendar-block-time">$\{blockDef.text.split(" (")[0]\}</div><div class="calendar-block-status">$\{blockDef.text.match(/\\(([^)]+)\\)/)[1]\}<br>Nicht verf\'fcgbar</div>`;\
                    cell.className = 'calendar-block disabled'; // Reset classes and add disabled\
                    cell.onclick = null;\
                \});\
                const doB3Cell = document.getElementById("Do_B3_cell"); // Special case from original code\
                if(doB3Cell) \{ doB3Cell.innerHTML = `<div class="calendar-block-time">Block 3 (12:30-16:00)</div><div class="calendar-block-status">Belegt</div>`; doB3Cell.className = 'calendar-block disabled'; doB3Cell.onclick = null; \}\
                return;\
            \}\
\
            const benoetigteDauer = kursDetails.dauerMin;\
            let passendeOptionenGefunden = false;\
\
            Object.keys(CONFIG.blockDefinitions).forEach(blockId => \{\
                const cell = document.getElementById(blockId + "_cell");\
                if (!cell) return;\
                const blockDef = CONFIG.blockDefinitions[blockId];\
                const simBlock = simulatedBlockStates.find(b => b.id === blockId);\
\
                let isAvailable = false;\
                let statusText = blockDef.text.match(/\\(([^)]+)\\)/)[1];\
                let verfuegbarFuer = "";\
                cell.className = 'calendar-block'; // Reset classes\
\
                if (benoetigteDauer === 45) \{ // FCU\
                    if (simBlock.status === "frei" || simBlock.status === "1_fcu_gebucht") \{\
                        isAvailable = true;\
                        verfuegbarFuer = "Verf\'fcgbar f\'fcr " + createTooltip("FCU", CONFIG.tooltipExplanations.FCU);\
                    \} else \{\
                        verfuegbarFuer = "Belegt";\
                    \}\
                \} else if (benoetigteDauer === 90) \{ // SYU\
                    if (simBlock.status === "frei") \{\
                        isAvailable = true;\
                        verfuegbarFuer = "Verf\'fcgbar f\'fcr " + createTooltip("SYU", CONFIG.tooltipExplanations.SYU);\
                    \} else \{\
                        verfuegbarFuer = "Belegt";\
                    \}\
                \}\
                statusText += `<br>$\{verfuegbarFuer\}`;\
                cell.innerHTML = `<div class="calendar-block-time">$\{blockDef.text.split(" (")[0]\}</div><div class="calendar-block-status">$\{statusText\}</div>`;\
\
                if (isAvailable) \{\
                    cell.classList.add('available');\
                    cell.onclick = () => selectCalendarBlock(blockId, blockDef.text);\
                    passendeOptionenGefunden = true;\
                \} else \{\
                    cell.classList.add('disabled');\
                \}\
            \});\
             // Special case from original code for Do_B3\
            const doB3Cell = document.getElementById("Do_B3_cell");\
            if(doB3Cell) \{ doB3Cell.innerHTML = `<div class="calendar-block-time">Block 3 (12:30-16:00)</div><div class="calendar-block-status">Belegt</div>`; doB3Cell.className = 'calendar-block disabled'; doB3Cell.onclick = null; \}\
\
\
            if (!passendeOptionenGefunden) \{\
                DOM.calendarErrorEl.style.display = 'block';\
            \}\
        \}\
\
        function selectCalendarBlock(blockId, blockText) \{\
            document.querySelectorAll('.calendar-block.selected').forEach(el => el.classList.remove('selected'));\
            const selectedCell = document.getElementById(blockId + "_cell");\
            if (selectedCell) selectedCell.classList.add('selected');\
            DOM.selectedBlockValueInput.value = blockId;\
            bookingData.zeitfensterValue = blockId;\
            bookingData.zeitfensterText = blockText;\
        \}\
\
        // --- BUSINESS LOGIC ---\
        function getKursDetailsLogic(fach, schulform, jahrgangStr) \{\
            let kstStunden = 0;\
            const jahrgang = parseInt(jahrgangStr);\
\
            if (jahrgang >= 7 && jahrgang <= 10) \{\
                if (fach === "Franz\'f6sisch") \{\
                    if (schulform === "RegS") kstStunden = 3;\
                    else if (["Gym", "MusikGym", "SportGym", "IGS"].includes(schulform)) kstStunden = (jahrgang <= 8) ? 4 : 3;\
                \} else if (fach === "Physik" && jahrgang === 9 && !["MusikGym", "SportGym"].includes(schulform)) kstStunden = 1;\
                else if (fach === "Physik" && jahrgang === 8 && ["MusikGym", "SportGym"].includes(schulform)) kstStunden = 1;\
                else if (fach === "Geschichte" && jahrgang === 7 && schulform === "RegS") kstStunden = 1;\
                else if (["Sozialkunde", "Philosophie"].includes(fach)) kstStunden = 1;\
                else if (fach === "Chemie" && (jahrgang === 7 || jahrgang === 8) && !["MusikGym", "SportGym"].includes(schulform)) kstStunden = 1;\
                else if (fach === "Chemie" && jahrgang === 8 && ["MusikGym", "SportGym"].includes(schulform)) kstStunden = 1;\
                else if (fach === "Biologie" && (jahrgang === 7 || jahrgang === 8 || (jahrgang === 9 && schulform === "RegS"))) kstStunden = 1;\
                else if (fach === "Englisch" && ((jahrgang === 8 && ["Gym", "MusikGym", "SportGym"].includes(schulform)) || (jahrgang === 9 && schulform === "RegS"))) kstStunden = 3;\
                else if (fach === "Deutsch" && jahrgang === 10 && ["Gym", "MusikGym", "SportGym", "RegS", "IGS"].includes(schulform)) kstStunden = 3;\
                else if (["Mathematik", "Deutsch", "Englisch"].includes(fach)) kstStunden = 4;\
                else if (schulform === "IGS" && fach === "Naturwissenschaften" && jahrgang === 7) kstStunden = 4;\
                else if (schulform === "IGS" && jahrgang === 7) \{\
                    if(fach === "Physik") kstStunden = 2; else if(fach === "Chemie") kstStunden = 1; else if(fach === "Biologie") kstStunden = 1; else kstStunden = 2;\
                \}\
                else kstStunden = 2;\
            \}\
            else if (jahrgang === 11 || jahrgang === 12) \{\
                 if (["Mathematik", "Deutsch", "Englisch", "Franz\'f6sisch"].includes(fach)) kstStunden = 4;\
                 else kstStunden = 0;\
            \}\
\
            if (kstStunden === 0) return \{ typ: "Nicht verf\'fcgbar", dauerMin: 0, ue: 0, kstStunden: 0, isFCU: false, syuUE: 0, asyuUE: 0\};\
            if (kstStunden === 1) return \{ typ: "Flipped Classroom Unterricht (FCU)", dauerMin: 45, ue: 1, kstStunden: 1, isFCU: true, syuUE: 0, asyuUE: 0 \};\
            if (kstStunden === 3) return \{ typ: "Synchronunterricht (SYU) mit Asynchronanteil (ASYU)", dauerMin: 90, ue: 3, kstStunden: 3, isFCU: false, syuUE: 2, asyuUE: 1 \};\
            if (kstStunden === 4) return \{ typ: "Synchronunterricht (SYU) mit Asynchronanteil (ASYU)", dauerMin: 90, ue: 4, kstStunden: 4, isFCU: false, syuUE: 2, asyuUE: 2 \};\
            return \{ typ: "Synchronunterricht (SYU)", dauerMin: 90, ue: 2, kstStunden: 2, isFCU: false, syuUE: 2, asyuUE: 0 \};\
        \}\
\
        function checkTimeCollisionLogic(neueStartMin, neueEndeMin, blockId) \{\
            const simBlock = simulatedBlockStates.find(b => b.id === blockId);\
            if (!simBlock || !simBlock.booked_fcu_times || simBlock.booked_fcu_times.length === 0) \{\
                return false; // No existing bookings in this block, so no collision\
            \}\
            const pufferMin = 15; // 15 minutes buffer\
            for (const gebucht of simBlock.booked_fcu_times) \{\
                // Check for overlap: (StartA <= EndB) and (EndA >= StartB)\
                if (Math.max(neueStartMin - pufferMin, gebucht.start - pufferMin) < Math.min(neueEndeMin + pufferMin, gebucht.end + pufferMin)) \{\
                    return true; // Collision detected\
                \}\
            \}\
            return false; // No collision\
        \}\
\
        // --- STEP VALIDATION AND DATA COLLECTION ---\
        function validateStep1() \{\
            if (!DOM.fachSelect.value) \{ alert('Bitte w\'e4hlen Sie ein Fach.'); return false; \}\
            bookingData.fach = DOM.fachSelect.value;\
            return true;\
        \}\
        function validateStep2() \{\
            if (!DOM.schulformSelect.value) \{ alert('Bitte w\'e4hlen Sie eine Schulform.'); return false; \}\
            bookingData.schulform = DOM.schulformSelect.value;\
            return true;\
        \}\
        function validateStep3() \{\
            if (!DOM.jahrgangSelect.value) \{ alert('Bitte w\'e4hlen Sie eine Jahrgangsstufe.'); return false; \}\
            if (!bookingData.kursDetails || bookingData.kursDetails.kstStunden === 0) \{\
                alert('F\'fcr diese Fach/Schulform/Jahrgang-Kombination ist kein Angebot vorgesehen. Bitte korrigieren Sie Ihre Auswahl.');\
                return false;\
            \}\
            bookingData.jahrgang = DOM.jahrgangSelect.value;\
            return true;\
        \}\
        function validateStep4() \{\
            if (!DOM.anforderungenBestaetigtCheckbox.checked) \{\
                DOM.anforderungenError.style.display = 'block';\
                return false;\
            \}\
            DOM.anforderungenError.style.display = 'none';\
            bookingData.anforderungen_bestaetigt = DOM.anforderungenBestaetigtCheckbox.checked;\
            return true;\
        \}\
        function validateStep5() \{\
            if (!DOM.selectedBlockValueInput.value) \{ alert('Bitte w\'e4hlen Sie ein Zeitfenster aus dem Kalender.'); return false; \}\
            // bookingData.zeitfensterValue and zeitfensterText are set in selectCalendarBlock\
            return true;\
        \}\
        function validateStep6() \{\
            let isValid = true;\
            DOM.startzeitError.style.display = 'none';\
            DOM.schuelerAnzahlError.style.display = 'none';\
\
            const startzeitInputVal = DOM.startzeitInput.value;\
            const schuelerAnzahlVal = DOM.schuelerAnzahlInput.value;\
            const kontaktNameVal = DOM.ansprechpartnerNameInput.value;\
            const kontaktEmailVal = DOM.ansprechpartnerEmailInput.value;\
\
            if (!startzeitInputVal) \{ alert('Bitte geben Sie eine gew\'fcnschte Startzeit an.'); isValid = false; \}\
            const schuelerAnzahlNum = parseInt(schuelerAnzahlVal);\
            if (isNaN(schuelerAnzahlNum) || schuelerAnzahlNum < 1) \{\
                DOM.schuelerAnzahlError.style.display = 'block';\
                isValid = false;\
            \}\
            if (!kontaktNameVal) \{ alert('Bitte geben Sie den Namen des Ansprechpartners an.'); isValid = false; \}\
            if (!kontaktEmailVal || !kontaktEmailVal.includes('@')) \{ alert('Bitte geben Sie eine g\'fcltige E-Mail-Adresse f\'fcr den Ansprechpartner an.'); isValid = false; \}\
\
            const blockDef = CONFIG.blockDefinitions[bookingData.zeitfensterValue];\
            if (blockDef && startzeitInputVal && bookingData.kursDetails) \{\
                const startzeitMin = timeToMinutes(startzeitInputVal);\
                const blockStartMin = timeToMinutes(blockDef.start);\
                const blockEndeMin = timeToMinutes(blockDef.end);\
                const kursEndeMin = startzeitMin + bookingData.kursDetails.dauerMin;\
\
                if (startzeitMin < blockStartMin || kursEndeMin > blockEndeMin) \{\
                    DOM.startzeitError.innerText = 'Die Kursdauer \'fcberschreitet das Blockende. Bitte w\'e4hlen Sie eine fr\'fchere Startzeit.';\
                    DOM.startzeitError.style.display = 'block';\
                    isValid = false;\
                \}\
                if (bookingData.kursDetails.dauerMin === 45) \{ // FCU collision check\
                    if (checkTimeCollisionLogic(startzeitMin, kursEndeMin, bookingData.zeitfensterValue)) \{\
                         DOM.startzeitError.innerText = 'Die gew\'e4hlte Zeit kollidiert mit einer anderen FCU-Buchung in diesem Block (inkl. 15 Min Puffer). Bitte w\'e4hlen Sie eine andere Startzeit.';\
                         DOM.startzeitError.style.display = 'block';\
                         isValid = false;\
                    \}\
                \}\
            \}\
            if (!isValid) return false;\
\
            // Collect data for step 6\
            bookingData.startzeit = startzeitInputVal;\
            bookingData.schuelerAnzahl = schuelerAnzahlVal;\
            const geraetTyp = document.querySelector('input[name="ausstattung_geraet_typ"]:checked');\
            bookingData.ausstattung_geraet_typ = geraetTyp ? geraetTyp.value : 'k.A.';\
            bookingData.ausstattung_kopfhoerer_schule = document.querySelector('input[name="ausstattung_kopfhoerer_schule"]:checked') ? 'Ja' : 'Nein';\
            bookingData.ausstattung_kopfhoerer_sus = document.querySelector('input[name="ausstattung_kopfhoerer_sus"]:checked') ? 'Ja' : 'Nein';\
            bookingData.ausstattung_mikrofon_schule = document.querySelector('input[name="ausstattung_mikrofon_schule"]:checked') ? 'Ja' : 'Nein';\
            bookingData.ausstattung_mikrofon_sus = document.querySelector('input[name="ausstattung_mikrofon_sus"]:checked') ? 'Ja' : 'Nein';\
            bookingData.ausstattung_kamera_sus = document.querySelector('input[name="ausstattung_kamera_sus"]:checked') ? 'Ja' : 'Nein';\
            bookingData.ausstattung_raum_digitafel = document.querySelector('input[name="ausstattung_raum_digitafel"]:checked') ? 'Ja' : 'Nein';\
            bookingData.ausstattung_raum_mikrofon_zentral = document.querySelector('input[name="ausstattung_raum_mikrofon_zentral"]:checked') ? 'Ja' : 'Nein';\
            const internetRaum = document.querySelector('input[name="internet_raum"]:checked');\
            bookingData.internet_raum = internetRaum ? internetRaum.value : 'k.A.';\
            bookingData.tutorial_kenntnis = DOM.tutorialKenntnisCheckbox.checked ? 'Ja, zur Kenntnis genommen' : 'Nein, nicht informiert';\
            const kontaktVorfeld = document.querySelector('input[name="kontakt_vorfeld"]:checked');\
            bookingData.kontakt_vorfeld = kontaktVorfeld ? kontaktVorfeld.value : 'k.A.';\
            bookingData.kontakt_name = kontaktNameVal;\
            bookingData.kontakt_email = kontaktEmailVal;\
            const einweisung = document.querySelector('input[name="einweisung"]:checked');\
            bookingData.einweisung = einweisung ? einweisung.value : 'k.A.';\
            bookingData.sonstiges_technik = DOM.sonstigesTechnikTextarea.value || 'Keine Angabe';\
            return true;\
        \}\
\
        function prepareStep5UI() \{\
            DOM.s5Fach.innerText = bookingData.fach;\
            DOM.s5Schulform.innerText = bookingData.schulform;\
            DOM.s5Jahrgang.innerText = bookingData.jahrgang;\
            DOM.s5KurstypKalender.innerHTML = addTooltipsToText(bookingData.kursDetails.typ);\
            populateCalendarUI();\
        \}\
        function prepareStep6UI() \{\
            DOM.s6BlockInfo.innerText = bookingData.zeitfensterText;\
            DOM.s6KurstypInfo.innerHTML = addTooltipsToText(bookingData.kursDetails.typ);\
            DOM.s6KursdauerInfo.innerText = bookingData.kursDetails.dauerMin;\
        \}\
        function prepareStep7UI_Summary() \{\
            const kursDetails = bookingData.kursDetails;\
            let summaryHTML = `\
                <p><strong>Fach:</strong> $\{bookingData.fach || 'N/A'\}</p>\
                <p><strong>Schulform:</strong> $\{bookingData.schulform || 'N/A'\}</p>\
                <p><strong>Jahrgangsstufe:</strong> $\{bookingData.jahrgang || 'N/A'\}</p>\
                <p><strong>Kurstyp:</strong> $\{addTooltipsToText(kursDetails.typ) || 'N/A'\}`;\
\
            if (kursDetails.isFCU && bookingData.abschlussVikoInfo) \{\
                summaryHTML += ` ($\{addTooltipsToText(bookingData.abschlussVikoInfo)\})`;\
            \} else if (kursDetails.asyuUE > 0) \{\
                summaryHTML += ` (davon $\{kursDetails.syuUE\} UE $\{createTooltip("SYU", CONFIG.tooltipExplanations.SYU)\}, $\{kursDetails.asyuUE\} UE $\{createTooltip("ASYU", CONFIG.tooltipExplanations.ASYU)\}. Abrechenbar: $\{kursDetails.kstStunden\} KST-Std.)`;\
            \}\
            summaryHTML += `</p>\
                <p><strong>Gew\'e4hltes Zeitfenster:</strong> $\{bookingData.zeitfensterText || 'N/A'\}</p>\
                <p><strong>Gew\'fcnschte Startzeit:</strong> $\{bookingData.startzeit || 'N/A'\}</p>\
                <p><strong>Anzahl Sch\'fcler/innen:</strong> $\{bookingData.schuelerAnzahl || 'N/A'\}</p>\
                <hr class="my-2">\
                <p><strong>Ansprechpartner/in f\'fcr R\'fcckfragen & Best\'e4tigungs-E-Mail:</strong> $\{bookingData.kontakt_name || 'N/A'\} ($\{bookingData.kontakt_email || 'N/A'\})</p>\
                <hr class="my-2">\
                <p><strong>Technische Ausstattung:</strong></p>\
                <ul class="list-disc list-inside pl-4 text-xs">\
                    <li>Pers. Endger\'e4t SuS Typ: $\{bookingData.ausstattung_geraet_typ\}</li>\
                    <li>Kopfh\'f6rer (Schule): $\{bookingData.ausstattung_kopfhoerer_schule\}</li>\
                    <li>Kopfh\'f6rer (SuS): $\{bookingData.ausstattung_kopfhoerer_sus\}</li>\
                    <li>Mikrofon (Schule): $\{bookingData.ausstattung_mikrofon_schule\}</li>\
                    <li>Mikrofon (SuS): $\{bookingData.ausstattung_mikrofon_sus\}</li>\
                    <li>Kamera SuS: $\{bookingData.ausstattung_kamera_sus\}</li>\
                    <li>Digitafel im Raum: $\{bookingData.ausstattung_raum_digitafel\}</li>\
                    <li>Zentralmikrofon im Raum: $\{bookingData.ausstattung_raum_mikrofon_zentral\}</li>\
                    <li>Internet im Raum: $\{bookingData.internet_raum\}</li>\
                </ul>\
                <p class="mt-1"><strong>Tutorialkurs-Information:</strong> $\{bookingData.tutorial_kenntnis\}</p>\
                <p><strong>Kontaktwunsch vorab (zur DiLaS-Lehrkraft):</strong> $\{bookingData.kontakt_vorfeld || 'N/A'\}</p>\
                <p><strong>Technische Einweisung ben\'f6tigt:</strong> $\{bookingData.einweisung || 'N/A'\}</p>\
                <p><strong>Sonstiges:</strong> <span class="whitespace-pre-wrap">$\{bookingData.sonstiges_technik || 'N/A'\}</span></p>\
            `;\
            DOM.summaryContainer.innerHTML = summaryHTML;\
            DOM.summaryKontaktEmailDisplay.innerText = bookingData.kontakt_email || 'Ihre E-Mail-Adresse';\
        \}\
\
\
        // --- NAVIGATION & PROCESS FLOW ---\
        function startBookingProcess() \{\
            showStepUI(1);\
        \}\
\
        function nextStep() \{\
            let isValid = false;\
            switch (currentStep) \{\
                case 1: isValid = validateStep1(); break;\
                case 2: isValid = validateStep2(); break;\
                case 3: isValid = validateStep3(); break;\
                case 4: isValid = validateStep4(); if(isValid) prepareStep5UI(); break;\
                case 5: isValid = validateStep5(); if(isValid) prepareStep6UI(); break;\
                case 6: isValid = validateStep6(); if(isValid) prepareStep7UI_Summary(); break;\
                case 7: // This is the summary step, next action is confirmBooking\
                    confirmBooking();\
                    return; // confirmBooking handles showing the final step\
            \}\
            if (isValid) \{\
                showStepUI(currentStep + 1);\
            \}\
        \}\
\
        function prevStep() \{\
            if (currentStep === 1) \{ // From step 1 back to welcome\
                showStepUI(0);\
            \} else if (currentStep > 1) \{\
                showStepUI(currentStep - 1);\
            \}\
        \}\
\
        function confirmBooking() \{\
            console.log("Buchungsanfrage Daten:", bookingData); // For debugging\
            const blockId = bookingData.zeitfensterValue;\
            const blockIndex = simulatedBlockStates.findIndex(b => b.id === blockId);\
\
            if (blockIndex !== -1 && bookingData.kursDetails) \{\
                const kursDauerMin = bookingData.kursDetails.dauerMin;\
                if (kursDauerMin === 45) \{ // FCU\
                    const neueStartMin = timeToMinutes(bookingData.startzeit);\
                    const neueEndeMin = neueStartMin + 45;\
                    simulatedBlockStates[blockIndex].booked_fcu_times.push(\{start: neueStartMin, end: neueEndeMin\});\
                    if (simulatedBlockStates[blockIndex].status === "frei") \{\
                        simulatedBlockStates[blockIndex].status = "1_fcu_gebucht";\
                    \} else if (simulatedBlockStates[blockIndex].status === "1_fcu_gebucht") \{\
                        simulatedBlockStates[blockIndex].status = "2_fcu_gebucht";\
                    \}\
                \} else if (kursDauerMin === 90) \{ // SYU\
                     simulatedBlockStates[blockIndex].status = "syu_gebucht";\
                \}\
            \}\
            DOM.confirmEmailDisplay.innerText = bookingData.kontakt_email || 'Ihre E-Mail-Adresse';\
            showStepUI(8); // Show confirmation screen\
            DOM.progressBar.style.width = '100%';\
            DOM.progressText.innerText = `Anfrage \'fcbermittelt`;\
        \}\
\
        function resetBookingProcess() \{\
            // Reset form fields\
            DOM.fachSelect.value = '';\
            DOM.schulformSelect.value = '';\
            DOM.jahrgangSelect.innerHTML = '<option value="">Bitte w\'e4hlen...</option>';\
            DOM.anforderungenBestaetigtCheckbox.checked = false;\
            DOM.selectedBlockValueInput.value = '';\
            document.querySelectorAll('.calendar-block.selected').forEach(el => el.classList.remove('selected'));\
            DOM.startzeitInput.value = '';\
            DOM.startzeitError.style.display = 'none';\
            DOM.schuelerAnzahlInput.value = '';\
            DOM.schuelerAnzahlError.style.display = 'none';\
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);\
            document.querySelectorAll('input[type="radio"]').forEach(rb => rb.checked = false);\
            DOM.ansprechpartnerNameInput.value = '';\
            DOM.ansprechpartnerEmailInput.value = '';\
            DOM.sonstigesTechnikTextarea.value = '';\
\
            // Reset bookingData object\
            bookingData = \{\};\
            DOM.kursInfoEl.innerHTML = '';\
\
            // Reset simulatedBlockStates to initial\
            simulatedBlockStates = JSON.parse(JSON.stringify(CONFIG.initialBlockStates));\
\
            showStepUI(0); // Go back to welcome screen\
        \}\
\
        // --- MODAL FUNCTIONS ---\
        function openDownloadModal() \{\
            DOM.downloadModal.classList.remove('modal-inactive');\
            DOM.downloadModal.classList.add('modal-active');\
        \}\
\
        function closeDownloadModal() \{\
            DOM.downloadModal.classList.remove('modal-active');\
            DOM.downloadModal.classList.add('modal-inactive');\
        \}\
\
        // --- EVENT LISTENERS ---\
        DOM.fachSelect.addEventListener('change', () => \{\
            updateJahrgangsDropdown();\
            updateKursInfoUI();\
        \});\
        DOM.schulformSelect.addEventListener('change', () => \{\
            updateJahrgangsDropdown();\
            updateKursInfoUI();\
        \});\
        DOM.jahrgangSelect.addEventListener('change', updateKursInfoUI);\
\
        // --- INITIALIZATION ---\
        function initializeForm() \{\
            populateFaecherDropdown();\
            updateJahrgangsDropdown(); // Initial call to set up Jahrgang based on default Fach/Schulform\
            showStepUI(0); // Start at the welcome screen\
        \}\
\
        document.addEventListener('DOMContentLoaded', initializeForm);\
\
    </script>\
</body>\
</html>\
}